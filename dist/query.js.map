{"version":3,"file":"query.js","sources":["../src/instance/index.ts","../src/globals/use.ts","../src/globals/extend.ts","../src/core/is.ts","../src/core/createQuery.ts","../src/core/index.ts"],"sourcesContent":["/**\n * show\n * \n * show the selected item\n *\n * @module query/show\n *\n * @example\n *\n * $('text').show()\n */\nexport function show() {\n    for (let i = 0; i < this.length; i++) {\n        this[i].visible = true\n    }\n    return this\n}\n\n/**\n * hide\n *\n * hide the selected item\n *\n * @module query/hide\n *\n * @example\n *\n * $('text').hide()\n */\nexport function hide() {\n    for (let i = 0; i < this.length; i++) {\n        this[i].visible = false\n    }\n    return this\n}\n\n/**\n * get\n * \n * get item by index or get a collection for selected items\n * \n * @module query/get\n * \n * @param index\n *\n * @example\n *\n * $('text').get()\n * // or\n * $('text').get(0)\n */\nexport function get(index: number) {\n    if (index) {\n        return this[index]\n    } else {\n        const pure = []\n        for (let i = 0; i < this.length; i++) {\n            pure.push(this[i])\n        }\n        return pure\n    }\n}\n\n/**\n * width\n * \n * if param `width` is type of number,\n * `width()` will set selected items' width property\n * else return the first selected item's width value\n * \n * @module query/width\n * \n * @param { Number } width\n *\n * @example\n *\n * $('text').width()\n */\nexport function width(width: number) {\n    if (typeof width === 'number') {\n        for (let i = 0; i < this.length; i++) {\n            this[i].width = width\n        }\n    } else {\n        return this[0].width\n    }\n}\n\n/**\n * height\n *\n * if param `height` is type of number,\n * `height()` will set selected items' height property\n * else return the first selected item's height value\n * \n * @module query/height\n *\n * @param { Number } height\n *\n * @example\n *\n * $('text').height()\n */\nexport function height(height: number) {\n    if (typeof height === 'number') {\n        for (let i = 0; i < this.length; i++) {\n            this[i].height = height\n        }\n    } else {\n        return this[0].height\n    }\n}\n\n/**\n * position\n * \n * return the first selected item's coordanites\n * \n * @module query/position\n *\n * @example\n *\n * $('text').position()\n */\nexport function position() {\n    return {\n        x: this[0] ? this[0].x : 0,\n        y: this[0] ? this[0].y : 0,\n    }\n}\n\n/**\n * children\n * \n * return the first selected item's children\n * \n * @module query/children\n *\n * @example\n *\n * $('text').children()\n */\nexport function children() {\n    return this[0] ? this[0].children : []\n}\n\n/**\n * count\n * \n * return the selected items' count\n * \n * @module query/count\n *\n * @example\n *\n * $('text').count()\n */\nexport function count() {\n    return this.length\n}\n\n/**\n * first\n *\n * return the first selected item\n * \n * @module query/first\n *\n * @example\n *\n * $('text').first()\n *\n * @example\n *\n * $('text').first()\n */\nexport function first() {\n    return this[0]\n}\n\n/**\n * last\n *\n * return the last selected item\n * \n * @module query/last\n *\n * @example\n *\n * $('text').last()\n */\nexport function last() {\n    return this[this.length - 1]\n}\n\n/**\n * each\n * \n * @module query/each\n * \n * @param { Function } closure - executeable functoin\n *\n * @example\n *\n * $('text').each(item => {\n *     $(item).hide()\n * })\n */\nexport function each(closure: (item: any, index: number) => void) {\n    for (let i = 0; i < this.length; i++) {\n        closure(this[i], i)\n    }\n}\n\n/**\n * empty\n * \n * remove the selected items' children\n * \n * @module query/empty\n *\n * @example\n *\n * $('text').empty()\n */\nexport function empty() {\n    for (let i = 0; i < this.length; i++) {\n        this[i].removeChildren()\n    }\n}\n\n/**\n * parent\n * \n * if the first selected item's parent exist, return it, else return `null`\n * \n * @module query/parent\n * \n * @example\n * \n * $('text').parent()\n */\nexport function parent() {\n    return this[0] ? this[0].parent : null\n}\n\nexport function text() {\n    console.log('text() not support yet')\n    return this[0] && this[0]._text && this[0]._text\n}\n\nexport function css() {\n    console.log('css() not support yet')\n}\n\nexport function find() {\n    console.log('find() not support yet')\n}\n\nexport function offset() {\n    console.log('offset() not support yet')\n}\n\nexport function prev() {\n    console.log('prev() not support yet')\n}\n\nexport function next() {\n    console.log('next() not support yet')\n}\n\n","export const fns = []\n\nexport function use(fn: () => void) {\n    fns.push(fn)\n}","/**\n * extend\n * \n * query extend method\n * \n * @module query/extend\n * \n * @param { Object | Array } target - extend target\n * \n * @example\n * \n * import query from '@amoy/query'\n * \n * query.extend({\n *     hide() {\n *         for (let i = 0; i < this.length; i++) {\n *             // hide all the selected items\n *             this[i].visible = false\n *         }\n *     },\n * })\n * \n * $('some query').hide()\n */\nexport function extend(target: any = []) {\n    if (Array.isArray(target)) {\n        target.map((item) => extend.bind(this)(item))\n    } else if (typeof target === 'object') {\n        Object.assign(this.prototype, target)\n    } else {\n        console.error(`query extension's type must be \"object\" or \"object[]\"`)\n    }\n}","export function sprite(target: any) {\n    return typeof target._anchor !== 'undefined' && typeof target._font === 'undefined'\n}\n\nexport function text(target: any) {\n    return typeof target._font === 'string'\n}\n\nexport function container(target: any) {\n    return typeof target.anchor === 'undefined'\n}","import * as is from './is'\nimport { fns } from '../globals/use'\nimport { IQuery } from '../types'\n\nexport function createQuery(stage: any, query: IQuery) {\n    return (selector: any) => {\n        const com = []\n        // @ts-ignore\n        const any = fns.reduce((prev: any, current: any) => current(prev, query), selector)\n        const type = typeof any\n\n        switch (type) {\n            case 'string':\n                selector = any.trim()\n                if (['container', 'sprite', 'text'].includes(selector)) {\n                    com.push(...getTypedItem(selector, get(stage)))\n                } else {\n                    const parsed = parseStringQuery(selector)\n                    parsed.map((item) => com.push(...findBy(item.key, item.value, get(stage))))\n                }\n                break\n            case 'object':\n                com.push(any)\n                break\n            default:\n                break\n        }\n\n        return Object.assign(com, query.prototype)\n    }\n}\n\nconst REG_PROP = /\\[(.*)\\=(.*)\\]/ // 匹配 `[${key}=${value}]` 形式字符串\n\nfunction parseStringQuery(query: string = '') {\n    const result = []\n    query.split(',').map((query: string) => {\n        query = query.trim()\n        const selectTypes = {\n            '#': 'id',\n            '.': 'className',\n        }\n        for (const key in selectTypes) {\n            if (query.startsWith(key)) {\n                result.push({\n                    key: selectTypes[key],\n                    value: query.slice(1),\n                })\n            }\n        }\n        if (REG_PROP.test(query)) {\n            const [key, value] = parsePropQuery(query)\n            result.push({\n                key,\n                value,\n            })\n        }\n    })\n    return result\n}\n\nfunction getTypedItem(type: string, source: any[]) {\n    return source.filter((item) => is[type](item))\n}\n\nfunction parsePropQuery(string: string) {\n    const [_, key, value] = string.match(REG_PROP)\n    return [key, value]\n}\n\nfunction get(object: any) {\n    const result = []\n    const walk = (object: any) => {\n        if (object.children.length > 0) {\n            result.push(...object.children)\n            object.children.map((child: any) => walk(child))\n        }\n    }\n    walk(object)\n    return result\n}\n\nfunction find(item: any, array: any[]) {\n    return array.filter((_item) => _item === item)\n}\n\nfunction findBy(key: string, value: any, array: any[]) {\n    return array.filter((item) => item[key] === value)\n}","import * as instance from '../instance'\nimport { use, extend } from '../globals'\nimport { createQuery } from './createQuery'\nimport queryEvent from '@amoy/query-event'\nimport { IQuery } from '../types'\n\n/**\n * query\n * \n * @module query/query\n * \n * @param { Object } stage - PIXI stage\n * \n * @example\n * \n * import { Application as Game } from 'pixi.js'\n * \n * const game = new Game({\n *     width: window.innerWidth,\n *     height: window.innerHeight,\n * })\n * \n * query(game.stage)\n * //then you can use as\n * $('sprite').hide()\n * // or\n * $('text').on('tap', () => {})\n */\n// @ts-ignore\nexport const query: IQuery = (stage: any) => window.$ = createQuery(stage, query)\n\nquery.use = use\nquery.extend = extend\n\nquery.extend([\n    queryEvent,\n    instance,\n])"],"names":["text","get"],"mappings":"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"}