{"version":3,"file":"query.js","sources":["../src/globals/extend.ts","../src/core/createQuery.ts","../src/extension/events.ts","../src/core/index.ts"],"sourcesContent":["export function extend(object: any = {}) {\n    Object.assign(this.prototype, object)\n}","export function createQuery(stage: any, query: () => void) {\n    return (selector: any) => {\n        const com = []\n        const type = typeof selector\n\n        switch (type) {\n            case 'string':\n                const parsed = parseStringQuery(selector)\n                parsed.map((item) => {\n                    com.push(...findBy(item.key, item.value, get(stage)))\n                })\n                break\n            case 'object':\n                com.push(...find(selector, get(stage)))\n                break\n            default:\n                break\n        }\n        return Object.assign(com, query.prototype)\n    }\n}\n\nconst REG_PROP = /\\[(.*)\\=(.*)\\]/ // 匹配 `[${key}=${value}]` 形式字符串\n\nfunction parseStringQuery(query: string = '') {\n    const result = []\n    query.split(',').map((query: string) => {\n        query = query.trim()\n        if (query.startsWith('.')) {\n            result.push({\n                key: 'name',\n                value: query.slice(1),\n            })\n        }\n        if (REG_PROP.test(query)) {\n            const [key, value] = parsePropQuery(query)\n            result.push({\n                key,\n                value,\n            })\n        }\n    })\n    return result\n}\n\nfunction parsePropQuery(string: string) {\n    const [_, key, value] = string.match(REG_PROP)\n    return [key, value]\n}\n\nfunction get(object: any) {\n    const result = []\n    const walk = (object: any) => {\n        if (object.children.length > 0) {\n            result.push(...object.children)\n            object.children.map((child: any) => walk(child))\n        }\n    }\n    walk(object)\n    return result\n}\n\nfunction find(item: any, array: any[]) {\n    return array.filter((_item) => _item === item)\n}\n\nfunction findBy(key: string, value: any, array: any[]) {\n    return array.filter((item) => item[key] === value)\n}","export function on(name: string = '', closure: () => void = () => {}) {\n    const events = name.split(' ')\n    for (let i = 0; i < this.length; i++) {\n        for (let j = 0; j < events.length; j++) {\n            this[i].interactive = true\n            this[i].on(events[j], closure)\n        }\n    }\n}\n\nexport function off(name: string = '') {\n    const events = name.split(' ')\n    for (let i = 0; i < this.length; i++) {\n        for (let j = 0; j < events.length; j++) {\n            this[i].off(events[j])\n        }\n    }\n}","import { extend } from '../globals'\nimport { createQuery } from './createQuery'\nimport * as extension from '../extension'\n\n// @ts-ignore\nexport const query = (stage: any) => window.$ = createQuery(stage, query)\n\nquery.extend = extend\n\nquery.extend(extension)\n\n"],"names":[],"mappings":"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"}