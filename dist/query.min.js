!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t=t||self).query={})}(this,function(t){"use strict";var n=Object.freeze({show:function(){for(var t=0;t<this.length;t++)this[t].visible=!0;return this},hide:function(){for(var t=0;t<this.length;t++)this[t].visible=!1;return this},get:function(t){if(t)return this[t];for(var n=[],i=0;i<this.length;i++)n.push(this[i]);return n},width:function(t){if("number"!=typeof t)return this[0].width;for(var n=0;n<this.length;n++)this[n].width=t},height:function(t){if("number"!=typeof t)return this[0].height;for(var n=0;n<this.length;n++)this[n].height=t},position:function(){return this[0]?{x:this[0].x,y:this[0].y}:null},children:function(){return this[0]?this[0].children:[]},count:function(){return this.length},first:function(){return this[0]},last:function(){return this[this.length-1]},each:function(t){for(var n=0;n<this.length;n++)t(this[n],n)},empty:function(){for(var t=0;t<this.length;t++)this[t].removeChildren()},parent:function(){return this[0]?this[0].parent:null},attr:function(t,n){if(this[0])return n?(this[0][t]=n,this[0]):this[0][t]},find:function(){console.log("find() not support yet")},prev:function(){var i=this;if(this[0]&&this[0].parent&&this[0].parent.children.length)return this[0].parent.children.filter(function(t,n){if(t===i[0])return i[0].parent.children[n-1]})[0]},next:function(){var i=this;if(this[0]&&this[0].parent&&this[0].parent.children.length)return this[0].parent.children.filter(function(t,n){if(t===i[0])return i[0].parent.children[n+1]})[0]}}),o=[];var s=Object.freeze({sprite:function(t){return void 0!==t._anchor&&void 0===t._font},text:function(t){return"string"==typeof t._font},container:function(t){return void 0===t.anchor}});function i(e,r){return function(t){var n=[],i=o.reduce(function(t,n){return n(t,r)},t);switch(typeof i){case"string":if(t=i.trim(),["view","sprite","text"].includes(t))n.push.apply(n,function(n,t){return t.filter(function(t){return s[n](t)})}(t,a(e)));else(function(t){void 0===t&&(t="");var o=[];return t.split(",").map(function(n){n=n.trim();var t={"#":["id"],".":["className","class","classname"]};for(var i in t)n.startsWith(i)&&t[i].map(function(t){o.push({key:t,value:n.slice(1)})});if(h.test(n)){var e=function(t){var n=t.match(h),i=(n[0],n[1]),e=n[2];return[i,e]}(n),r=(i=e[0],e[1]);o.push({key:i,value:r})}}),o})(t).map(function(t){return n.push.apply(n,function(n,i,t){return t.filter(function(t){return"string"!=typeof t[n]?t[n]===i:t[n].split(" ").includes(i)})}(t.key,t.value,a(e)))});break;case"object":n.push(i)}return Object.assign(n,r.prototype)}}var h=/\[(.*)\=(.*)\]/;function a(t){var n=[],i=function(t){0<t.children.length&&(n.push.apply(n,t.children),t.children.map(function(t){return i(t)}))};return i(t),n}function u(t,n){if("object"!==function(t){var n={},i=n.toString.call(t);return null==t?t+"":("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" ").forEach(function(t){n["[object "+t+"]"]=t.toLowerCase()}),"object"==typeof t||"function"==typeof t?n[i]||"object":typeof t)}(t))return t;for(var i=t,e=n.split("."),r=0,o=e.length;r<o;r++){var s=e[r];if(s){if(!i[s]){i=void 0;break}i=i[s]}}return i}var e=(r.prototype.add=function(t){return this.handlers.push(t),this},r.prototype.del=function(i){var e=this;return i?this.handlers.map(function(t,n){t===i&&e.handlers.splice(n,1)}):this.handlers=[],this},r.prototype.fire=function(n,i){if(this.handlers&&this.handlers.length)return this.handlers.map(function(t){"function"==typeof t&&t.bind(i)(n)}),this},r.prototype.clear=function(){this.handlers=[]},r);function r(){this.handlers=[]}var c={getCurTargetByEv:function(t,n){var i,e=0;if(u(t,"children.length")&&t.children.map(function(t){t.containsPoint&&t.containsPoint(n.data.global)&&t.zIndex>=e&&(e=(i=t).zIndex)}),i){var r=c.getCurTargetByEv(i,n);r&&(i=r)}return i||t},getFingers:function(t){return u(t,"data.originalEvent.touches.length")||1},getPoint:function(t,n){if("touch"!==t.data.pointerType)return{x:Math.round(t.data.global.x),y:Math.round(t.data.global.y)};var i=t.data.originalEvent.touches;return{x:Math.round(i[n].pageX),y:Math.round(i[n].pageY)}},getVector:function(t,n){return{x:Math.round(t.x-n.x),y:Math.round(t.y-n.y)}},getLength:function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},getAngle:function(t,n){if("object"==typeof t&&"object"==typeof n){var i,e=0<t.x*n.y-n.x*t.y?1:-1,r=this.getLength(t)*this.getLength(n);return 0==r?0:(1<(i=(t.x*n.x+t.y*n.y)/r)&&(i=1),i<-1&&(i=-1),Math.acos(i)*e)}console.error("getAngle error!")},getAnchorPoint:function(t){return{x:t.x,y:t.y}}},f=["touchstart","touchmove","touchend","drag","dragstart","dragend","pinch","pinchstart","pinchend","rotate","rotatestart","rotateend","swipeleft","swiperight","swipeup","swipedown","shorttap","longtap","singlepinch","singlepinchstart","singlepinchend","singlerotate","singlerotatestart","singlerotateend"],g=[{name:"pointerdown",fn:"_start"},{name:"pointermove",fn:"_move"},{name:"pointerup",fn:"_end"},{name:"pointerupoutside",fn:"_end"}],p=(l.prototype.initEventBus=function(){var n=this;f.map(function(t){Object.defineProperty(n.Bus,t,{value:new e})})},l.prototype.bindOriginEvent=function(){var e=this;g.map(function(t){var n=t.name,i=t.fn;e.target.interactive=!0,e.target.on(n,e[i],e)})},l.prototype._start=function(t){var n=this;this.touching=!0,this.startTime=Date.now(),this.fingers=c.getFingers(t),this.swipeStartPoint=this.startPoint=c.getPoint(t,0),this.singleBasePoint=c.getAnchorPoint(this.target);var i=c.getCurTargetByEv(t.target,t);if(this.isSingleButton=i&&"singlebutton"===i.name,1===this.fingers){var e=c.getVector(this.startPoint,this.singleBasePoint);this.singlePinchStartLength=c.getLength(e)}else 1<this.fingers&&(this.secondPoint=c.getPoint(t,1),this.vector1=c.getVector(this.secondPoint,this.startPoint),this.pinchStartLength=c.getLength(this.vector1));this.longtapTimer=setTimeout(function(){n.fireEvent("longtap",{origin:t}),n.longtapTimer=null},1e3),this.fireEvent("touchstart",{origin:t})},l.prototype._move=function(t){if(this.touching){var n=c.getPoint(t,0);if(this.startPoint||(this.startPoint=n),1<this.fingers){var i=c.getPoint(t,1),e=c.getVector(i,n),r=c.getLength(e);this.pinchStartLength&&(this.eventStart("pinch",{origin:t,delta:{scale:r/this.pinchStartLength}}),this.pinchStartLength=r),this.vector1&&(this.eventStart("rotate",{delta:{rotate:c.getAngle(this.vector1,e)},origin:t}),this.vector1=e)}else{if(this.isSingleButton){var o=c.getVector(n,this.singleBasePoint),s=c.getLength(o);this.eventStart("singlepinch",{delta:{scale:s/this.singlePinchStartLength,deltaX:n.x-this.startPoint.x,deltaY:n.y-this.startPoint.y},origin:t}),this.singlePinchStartLength=s}if(this.isSingleButton){var h=c.getVector(this.startPoint,this.singleBasePoint),a=c.getVector(n,this.singleBasePoint);this.eventStart("singlerotate",{delta:{rotate:c.getAngle(h,a)},origin:t})}}this.eventStart("drag",{delta:{x:n.x-this.startPoint.x,y:n.y-this.startPoint.y},origin:t}),this.fireEvent("touchmove",{origin:t}),this.startPoint=n}},l.prototype._end=function(n){var i=this;if(this.touching=!1,this.fingers=c.getFingers(n),["pinch","drag","rotate","singlerotate","singlepinch"].map(function(t){i.eventEnd(t,{origin:n,type:t})}),this.swipeStartPoint){var t=Math.round(n.data.global.x),e=Math.round(n.data.global.y),r=t-this.swipeStartPoint.x,o=e-this.swipeStartPoint.y,s=Date.now(),h="";30<r&&Math.abs(o)<100?h="swiperight":r<-30&&Math.abs(o)<100?h="swipeleft":30<o&&Math.abs(r)<100?h="swipedown":o<-30&&Math.abs(r)<100?h="swipeup":Math.abs(r)<30&&Math.abs(o)<30&&s-this.startTime<500&&(h="shorttap"),h&&this.fireEvent(h,{origin:n})}this.fireEvent("touchend",{origin:n}),this.longtapTimer&&clearTimeout(this.longtapTimer)},l.prototype.fireEvent=function(t,n){this.Bus[t]&&this.Bus[t].fire(Object.assign(n,{type:t,stopPropagation:function(){n.origin.stopPropagation()}}),this.target)},l.prototype.destory=function(){var e=this;g.map(function(t){var n=t.name,i=t.fn;e.target.off(n,e[i],e)})},l.prototype.eventStart=function(t,n){var i=t+"ing",e=t+"start";this[i]?this.fireEvent(t,n):(this.fireEvent(e,n),this[i]=!0)},l.prototype.eventEnd=function(t,n){var i=t+"ing",e=t+"end";this[i]&&(n.type=e,this.fireEvent(e,n),this[i]=!1)},l.prototype.on=function(t,n){var i=this;return t.trim().toLowerCase().split(" ").map(function(t){i.Bus[t].add(n)}),this},l.prototype.off=function(t,n){var i=this;return t.trim().toLowerCase().split(" ").map(function(t){n?i.Bus[t].del(n):i.Bus[t].clear()}),this},l);function l(t){this.fingers=0,this.touching=!1,this.isSingleButton=!1,this.Bus={},this.target=t,this.initEventBus(),this.bindOriginEvent()}var d={on:function(t,n){void 0===t&&(t=""),void 0===n&&(n=function(){});for(var i,e,r,o=t.split(" "),s=0;s<this.length;s++)for(var h=0;h<o.length;h++)this[s].interactive=!0,i=this[s],e=o[h],r=n,f.includes(e)?(i.RTouch||(i.RTouch=new p(i)),i.RTouch.on(e,r)):(i.interactive=!0,i.on(e,r));return this},off:function(t){void 0===t&&(t="");for(var n,i,e,r=t.split(" "),o=0;o<this.length;o++)for(var s=0;s<r.length;s++)this[o].off(r[s]),n=this[o],i=r[s],e=void 0,f.includes(i)&&n.RTouch?n.RTouch.off(i,e):(n.interactive=!0,n.off(i,e));return this}},v=function(t){return window.$=i(t,v)};v.use=function(t){o.push(t)},v.extend=function n(t){var i=this;void 0===t&&(t=[]),Array.isArray(t)?t.map(function(t){return n.bind(i)(t)}):"object"==typeof t?Object.assign(this.prototype,t):console.error('query extension\'s type must be "object" or "object[]"')},v.extend([d,n]),t.query=v,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=query.min.js.map
