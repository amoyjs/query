{"version":3,"file":"query.es.js","sources":["../lib/instance/index.ts","../lib/globals/use.ts","../lib/globals/extend.ts","../lib/core/is.ts","../lib/core/createQuery.ts","../lib/core/index.ts"],"sourcesContent":["/**\n * show\n * \n * show the selected item\n *\n * @module query/show\n *\n * @example\n *\n * $('text').show()\n */\nexport function show(this: any) {\n    for (let i = 0; i < this.length; i++) {\n        this[i].visible = true\n    }\n    return this\n}\n\n/**\n * hide\n *\n * hide the selected item\n *\n * @module query/hide\n *\n * @example\n *\n * $('text').hide()\n */\nexport function hide(this: any) {\n    for (let i = 0; i < this.length; i++) {\n        this[i].visible = false\n    }\n    return this\n}\n\n/**\n * get\n * \n * get item by index or get a collection for selected items\n * \n * @module query/get\n * \n * @param index\n *\n * @example\n *\n * $('text').get()\n * // or\n * $('text').get(0)\n */\nexport function get(this: any, index: number) {\n    if (index) {\n        return this[index]\n    } else {\n        const pure: any[] = []\n        for (let i = 0; i < this.length; i++) {\n            pure.push(this[i])\n        }\n        return pure\n    }\n}\n\n/**\n * width\n * \n * if param `width` is type of number,\n * `width()` will set selected items' width property\n * else return the first selected item's width value\n * \n * @module query/width\n * \n * @param { Number } width\n *\n * @example\n *\n * $('text').width()\n */\nexport function width(this: any, width: number) {\n    if (typeof width === 'number') {\n        for (let i = 0; i < this.length; i++) {\n            this[i].width = width\n        }\n    } else {\n        return this[0].width\n    }\n}\n\n/**\n * height\n *\n * if param `height` is type of number,\n * `height()` will set selected items' height property\n * else return the first selected item's height value\n * \n * @module query/height\n *\n * @param { Number } height\n *\n * @example\n *\n * $('text').height()\n */\nexport function height(this: any, height: number) {\n    if (typeof height === 'number') {\n        for (let i = 0; i < this.length; i++) {\n            this[i].height = height\n        }\n    } else {\n        return this[0].height\n    }\n}\n\n/**\n * position\n * \n * return the first selected item's coordanites\n * \n * @module query/position\n *\n * @example\n *\n * $('text').position()\n */\nexport function position(this: any) {\n    return {\n        x: this[0] ? this[0].x : 0,\n        y: this[0] ? this[0].y : 0,\n    }\n}\n\n/**\n * children\n * \n * return the first selected item's children\n * \n * @module query/children\n *\n * @example\n *\n * $('text').children()\n */\nexport function children(this: any) {\n    return this[0] ? this[0].children : []\n}\n\n/**\n * count\n * \n * return the selected items' count\n * \n * @module query/count\n *\n * @example\n *\n * $('text').count()\n */\nexport function count(this: any) {\n    return this.length\n}\n\n/**\n * first\n *\n * return the first selected item\n * \n * @module query/first\n *\n * @example\n *\n * $('text').first()\n *\n * @example\n *\n * $('text').first()\n */\nexport function first(this: any) {\n    return this[0]\n}\n\n/**\n * last\n *\n * return the last selected item\n * \n * @module query/last\n *\n * @example\n *\n * $('text').last()\n */\nexport function last(this: any) {\n    return this[this.length - 1]\n}\n\n/**\n * each\n * \n * @module query/each\n * \n * @param { Function } closure - executeable functoin\n *\n * @example\n *\n * $('text').each(item => {\n *     $(item).hide()\n * })\n */\nexport function each(this: any, closure: (item: any, index: number) => void) {\n    for (let i = 0; i < this.length; i++) {\n        closure(this[i], i)\n    }\n}\n\n/**\n * empty\n * \n * remove the selected items' children\n * \n * @module query/empty\n *\n * @example\n *\n * $('text').empty()\n */\nexport function empty(this: any) {\n    for (let i = 0; i < this.length; i++) {\n        this[i].removeChildren()\n    }\n}\n\n/**\n * parent\n * \n * if the first selected item's parent exist, return it, else return `null`\n * \n * @module query/parent\n * \n * @example\n * \n * $('text').parent()\n */\nexport function parent(this: any) {\n    return this[0] ? this[0].parent : null\n}\n\nexport function text(this: any) {\n    console.log('text() not support yet')\n    return this[0] && this[0]._text && this[0]._text\n}\n\nexport function css() {\n    console.log('css() not support yet')\n}\n\nexport function find() {\n    console.log('find() not support yet')\n}\n\nexport function offset() {\n    console.log('offset() not support yet')\n}\n\nexport function prev() {\n    console.log('prev() not support yet')\n}\n\nexport function next() {\n    console.log('next() not support yet')\n}\n","export const fns: any[] = []\n\nexport function use(fn: () => void) {\n    fns.push(fn)\n}\n","/**\n * extend\n * \n * query extend method\n * \n * @module query/extend\n * \n * @param { Object | Array } target - extend target\n * \n * @example\n * \n * import query from '@amoy/query'\n * \n * query.extend({\n *     hide() {\n *         for (let i = 0; i < this.length; i++) {\n *             // hide all the selected items\n *             this[i].visible = false\n *         }\n *     },\n * })\n * \n * $('some query').hide()\n */\nexport function extend(this: any, target: any = []) {\n    if (Array.isArray(target)) {\n        target.map((item) => extend.bind(this)(item))\n    } else if (typeof target === 'object') {\n        Object.assign(this.prototype, target)\n    } else {\n        console.error(`query extension's type must be \"object\" or \"object[]\"`)\n    }\n}\n","export function sprite(target: any) {\n    return typeof target._anchor !== 'undefined' && typeof target._font === 'undefined'\n}\n\nexport function text(target: any) {\n    return typeof target._font === 'string'\n}\n\nexport function container(target: any) {\n    return typeof target.anchor === 'undefined'\n}\n","import * as is from './is'\nimport { fns } from '../globals/use'\n\nexport function createQuery(stage: any, query: typeof $) {\n    return (selector: any) => {\n        const com: any[] = []\n        // @ts-ignore\n        const any = fns.reduce((prev: any, current: any) => current(prev, query), selector)\n        const type = typeof any\n\n        switch (type) {\n            case 'string':\n                selector = any.trim()\n                if (['container', 'sprite', 'text'].includes(selector)) {\n                    com.push(...getTypedItem(selector, get(stage)))\n                } else {\n                    const parsed = parseStringQuery(selector)\n                    parsed.map((item: any) => com.push(...findBy(item.key, item.value, get(stage))))\n                }\n                break\n            case 'object':\n                com.push(any)\n                break\n            default:\n                break\n        }\n\n        return Object.assign(com, query.prototype)\n    }\n}\n\nconst REG_PROP = /\\[(.*)\\=(.*)\\]/ // 匹配 `[${key}=${value}]` 形式字符串\n\nfunction parseStringQuery(query: string = '') {\n    const result: any[] = []\n    query.split(',').map((query: string) => {\n        query = query.trim()\n        const selectTypes = {\n            '#': 'id',\n            '.': 'className',\n        }\n        for (const key in selectTypes) {\n            if (query.startsWith(key)) {\n                result.push({\n                    key: selectTypes[key],\n                    value: query.slice(1),\n                })\n            }\n        }\n        if (REG_PROP.test(query)) {\n            const [key, value] = parsePropQuery(query)\n            result.push({\n                key,\n                value,\n            })\n        }\n    })\n    return result\n}\n\nfunction getTypedItem(type: string, source: any[]) {\n    return source.filter((item) => is[type](item))\n}\n\nfunction parsePropQuery(string: string) {\n    const [_, key, value] = string.match(REG_PROP) as any\n    return [key, value]\n}\n\nfunction get(object: any) {\n    const result: any[] = []\n    const walk = (object: any) => {\n        if (object.children.length > 0) {\n            result.push(...object.children)\n            object.children.map((child: any) => walk(child))\n        }\n    }\n    walk(object)\n    return result\n}\n\nfunction find(item: any, array: any[]) {\n    return array.filter((_item) => _item === item)\n}\n\nfunction findBy(key: string, value: any, array: any[]) {\n    return array.filter((item) => item[key] === value)\n}\n","import * as instance from '../instance'\nimport { use, extend } from '../globals'\nimport { createQuery } from './createQuery'\nimport queryEvent from '@amoy/query-event'\n\nexport const query = (stage: any) => window.$ = createQuery(stage, query)\nquery.use = use\nquery.extend = extend\n\nquery.extend([\n    queryEvent,\n    instance,\n])\n"],"names":["text","get"],"mappings":"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"}