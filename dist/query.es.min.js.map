{"version":3,"file":"query.es.min.js","sources":["../src/instance/index.ts","../src/globals/use.ts","../src/globals/extend.ts","../src/core/is.ts","../src/core/createQuery.ts","../src/core/index.ts"],"sourcesContent":["/**\n * show\n * \n * show the selected item\n *\n * @module query/show\n *\n * @example\n *\n * $('text').show()\n */\nexport function show() {\n    for (let i = 0; i < this.length; i++) {\n        this[i].visible = true\n    }\n    return this\n}\n\n/**\n * hide\n *\n * hide the selected item\n *\n * @module query/hide\n *\n * @example\n *\n * $('text').hide()\n */\nexport function hide() {\n    for (let i = 0; i < this.length; i++) {\n        this[i].visible = false\n    }\n    return this\n}\n\n/**\n * get\n * \n * get item by index or get a collection for selected items\n * \n * @module query/get\n * \n * @param index\n *\n * @example\n *\n * $('text').get()\n * // or\n * $('text').get(0)\n */\nexport function get(index: number) {\n    if (index) {\n        return this[index]\n    } else {\n        const pure = []\n        for (let i = 0; i < this.length; i++) {\n            pure.push(this[i])\n        }\n        return pure\n    }\n}\n\n/**\n * width\n * \n * if param `width` is type of number,\n * `width()` will set selected items' width property\n * else return the first selected item's width value\n * \n * @module query/width\n * \n * @param { Number } width\n *\n * @example\n *\n * $('text').width()\n */\nexport function width(width: number) {\n    if (typeof width === 'number') {\n        for (let i = 0; i < this.length; i++) {\n            this[i].width = width\n        }\n    } else {\n        return this[0].width\n    }\n}\n\n/**\n * height\n *\n * if param `height` is type of number,\n * `height()` will set selected items' height property\n * else return the first selected item's height value\n * \n * @module query/height\n *\n * @param { Number } height\n *\n * @example\n *\n * $('text').height()\n */\nexport function height(height: number) {\n    if (typeof height === 'number') {\n        for (let i = 0; i < this.length; i++) {\n            this[i].height = height\n        }\n    } else {\n        return this[0].height\n    }\n}\n\n/**\n * position\n * \n * return the first selected item's coordanites\n * \n * @module query/position\n *\n * @example\n *\n * $('text').position()\n */\nexport function position() {\n    return {\n        x: this[0] ? this[0].x : 0,\n        y: this[0] ? this[0].y : 0,\n    }\n}\n\n/**\n * children\n * \n * return the first selected item's children\n * \n * @module query/children\n *\n * @example\n *\n * $('text').children()\n */\nexport function children() {\n    return this[0] ? this[0].children : []\n}\n\n/**\n * count\n * \n * return the selected items' count\n * \n * @module query/count\n *\n * @example\n *\n * $('text').count()\n */\nexport function count() {\n    return this.length\n}\n\n/**\n * first\n *\n * return the first selected item\n * \n * @module query/first\n *\n * @example\n *\n * $('text').first()\n *\n * @example\n *\n * $('text').first()\n */\nexport function first() {\n    return this[0]\n}\n\n/**\n * last\n *\n * return the last selected item\n * \n * @module query/last\n *\n * @example\n *\n * $('text').last()\n */\nexport function last() {\n    return this[this.length - 1]\n}\n\n/**\n * each\n * \n * @module query/each\n * \n * @param { Function } closure - executeable functoin\n *\n * @example\n *\n * $('text').each(item => {\n *     $(item).hide()\n * })\n */\nexport function each(closure: (item: any, index: number) => void) {\n    for (let i = 0; i < this.length; i++) {\n        closure(this[i], i)\n    }\n}\n\n/**\n * empty\n * \n * remove the selected items' children\n * \n * @module query/empty\n *\n * @example\n *\n * $('text').empty()\n */\nexport function empty() {\n    for (let i = 0; i < this.length; i++) {\n        this[i].removeChildren()\n    }\n}\n\n/**\n * parent\n * \n * if the first selected item's parent exist, return it, else return `null`\n * \n * @module query/parent\n * \n * @example\n * \n * $('text').parent()\n */\nexport function parent() {\n    return this[0] ? this[0].parent : null\n}\n\nexport function text() {\n    console.log('text() not support yet')\n    return this[0] && this[0]._text && this[0]._text\n}\n\nexport function css() {\n    console.log('css() not support yet')\n}\n\nexport function find() {\n    console.log('find() not support yet')\n}\n\nexport function offset() {\n    console.log('offset() not support yet')\n}\n\nexport function prev() {\n    console.log('prev() not support yet')\n}\n\nexport function next() {\n    console.log('next() not support yet')\n}\n\n","export const fns = []\n\nexport function use(fn: () => void) {\n    fns.push(fn)\n}","/**\n * extend\n * \n * query extend method\n * \n * @module query/extend\n * \n * @param { Object | Array } target - extend target\n * \n * @example\n * \n * import query from '@amoy/query'\n * \n * query.extend({\n *     hide() {\n *         for (let i = 0; i < this.length; i++) {\n *             // hide all the selected items\n *             this[i].visible = false\n *         }\n *     },\n * })\n * \n * $('some query').hide()\n */\nexport function extend(target: any = []) {\n    if (Array.isArray(target)) {\n        target.map((item) => extend.bind(this)(item))\n    } else if (typeof target === 'object') {\n        Object.assign(this.prototype, target)\n    } else {\n        console.error(`query extension's type must be \"object\" or \"object[]\"`)\n    }\n}","export function sprite(target: any) {\n    return typeof target._anchor !== 'undefined' && typeof target._font === 'undefined'\n}\n\nexport function text(target: any) {\n    return typeof target._font === 'string'\n}\n\nexport function container(target: any) {\n    return typeof target.anchor === 'undefined'\n}","import * as is from './is'\nimport { fns } from '../globals/use'\nimport { IQuery } from '../types'\n\nexport function createQuery(stage: any, query: IQuery) {\n    return (selector: any) => {\n        const com = []\n        // @ts-ignore\n        const any = fns.reduce((prev: any, current: any) => current(prev, query), selector)\n        const type = typeof any\n\n        switch (type) {\n            case 'string':\n                selector = any.trim()\n                if (['container', 'sprite', 'text'].includes(selector)) {\n                    com.push(...getTypedItem(selector, get(stage)))\n                } else {\n                    const parsed = parseStringQuery(selector)\n                    parsed.map((item) => com.push(...findBy(item.key, item.value, get(stage))))\n                }\n                break\n            case 'object':\n                com.push(any)\n                break\n            default:\n                break\n        }\n\n        return Object.assign(com, query.prototype)\n    }\n}\n\nconst REG_PROP = /\\[(.*)\\=(.*)\\]/ // 匹配 `[${key}=${value}]` 形式字符串\n\nfunction parseStringQuery(query: string = '') {\n    const result = []\n    query.split(',').map((query: string) => {\n        query = query.trim()\n        const selectTypes = {\n            '#': 'id',\n            '.': 'className',\n        }\n        for (const key in selectTypes) {\n            if (query.startsWith(key)) {\n                result.push({\n                    key: selectTypes[key],\n                    value: query.slice(1),\n                })\n            }\n        }\n        if (REG_PROP.test(query)) {\n            const [key, value] = parsePropQuery(query)\n            result.push({\n                key,\n                value,\n            })\n        }\n    })\n    return result\n}\n\nfunction getTypedItem(type: string, source: any[]) {\n    return source.filter((item) => is[type](item))\n}\n\nfunction parsePropQuery(string: string) {\n    const [_, key, value] = string.match(REG_PROP)\n    return [key, value]\n}\n\nfunction get(object: any) {\n    const result = []\n    const walk = (object: any) => {\n        if (object.children.length > 0) {\n            result.push(...object.children)\n            object.children.map((child: any) => walk(child))\n        }\n    }\n    walk(object)\n    return result\n}\n\nfunction find(item: any, array: any[]) {\n    return array.filter((_item) => _item === item)\n}\n\nfunction findBy(key: string, value: any, array: any[]) {\n    return array.filter((item) => item[key] === value)\n}","import * as instance from '../instance'\nimport { use, extend } from '../globals'\nimport { createQuery } from './createQuery'\nimport queryEvent from '@amoy/query-event'\nimport { IQuery } from '../types'\n\n/**\n * query\n * \n * @module query/query\n * \n * @param { Object } stage - PIXI stage\n * \n * @example\n * \n * import { Application as Game } from 'pixi.js'\n * \n * const game = new Game({\n *     width: window.innerWidth,\n *     height: window.innerHeight,\n * })\n * \n * query(game.stage)\n * //then you can use as\n * $('sprite').hide()\n * // or\n * $('text').on('tap', () => {})\n */\n// @ts-ignore\nexport const query: IQuery = (stage: any) => window.$ = createQuery(stage, query)\n\nquery.use = use\nquery.extend = extend\n\nquery.extend([\n    queryEvent,\n    instance,\n])"],"names":["show","i","length","visible","hide","get","index","pure","push","width","height","position","x","y","children","count","first","last","each","closure","empty","removeChildren","parent","text","console","log","_text","css","find","offset","prev","next","fns","use","fn","extend","target","Array","isArray","map","item","bind","_this","Object","assign","prototype","error","sprite","_anchor","_font","container","anchor","createQuery","stage","query","selector","com","any","reduce","current","trim","includes","getTypedItem","parsed","parseStringQuery","findBy","key","value","REG_PROP","result","split","selectTypes","startsWith","slice","test","_a","type","source","filter","is","parsePropQuery","string","_","object","walk","child","array","window","$","queryEvent","instance"],"mappings":"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"}