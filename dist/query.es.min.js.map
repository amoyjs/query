{"version":3,"file":"query.es.min.js","sources":["../src/globals/extend.ts","../src/core/is.ts","../src/core/createQuery.ts","../src/core/index.ts"],"sourcesContent":["export function extend(object: any = {}) {\n    Object.assign(this.prototype, object)\n}","export function sprite(target: any) {\n    return typeof target._anchor !== 'undefined' && typeof target._font === 'undefined'\n}\n\nexport function text(target: any) {\n    return typeof target._font === 'string'\n}\n\nexport function container(target: any) {\n    return typeof target.anchor === 'undefined'\n}","import * as is from './is'\n\nexport function createQuery(stage: any, query: () => void) {\n    return (selector: any) => {\n        const com = []\n        const type = typeof selector\n\n        switch (type) {\n            case 'string':\n                selector = selector.trim()\n                if (['container', 'sprite', 'text'].includes(selector)) {\n                    com.push(...getTypedItem(selector, get(stage)))\n                } else {\n                    const parsed = parseStringQuery(selector)\n                    parsed.map((item) => com.push(...findBy(item.key, item.value, get(stage))))\n                }\n                break\n            case 'object':\n                com.push(...find(selector, get(stage)))\n                break\n            default:\n                break\n        }\n        return Object.assign(com, query.prototype)\n    }\n}\n\nconst REG_PROP = /\\[(.*)\\=(.*)\\]/ // 匹配 `[${key}=${value}]` 形式字符串\n\nfunction parseStringQuery(query: string = '') {\n    const result = []\n    query.split(',').map((query: string) => {\n        query = query.trim()\n        if (query.startsWith('.')) {\n            result.push({\n                key: 'name',\n                value: query.slice(1),\n            })\n        }\n        if (REG_PROP.test(query)) {\n            const [key, value] = parsePropQuery(query)\n            result.push({\n                key,\n                value,\n            })\n        }\n    })\n    return result\n}\n\nfunction getTypedItem(type: string, source: any[]) {\n    return source.filter((item) => is[type](item))\n}\n\nfunction parsePropQuery(string: string) {\n    const [_, key, value] = string.match(REG_PROP)\n    return [key, value]\n}\n\nfunction get(object: any) {\n    const result = []\n    const walk = (object: any) => {\n        if (object.children.length > 0) {\n            result.push(...object.children)\n            object.children.map((child: any) => walk(child))\n        }\n    }\n    walk(object)\n    return result\n}\n\nfunction find(item: any, array: any[]) {\n    return array.filter((_item) => _item === item)\n}\n\nfunction findBy(key: string, value: any, array: any[]) {\n    return array.filter((item) => item[key] === value)\n}","import { extend } from '../globals'\nimport { createQuery } from './createQuery'\n\n// @ts-ignore\nexport const query = (stage: any) => window.$ = createQuery(stage, query)\n\nquery.extend = extend\n"],"names":["extend","object","Object","assign","prototype","sprite","target","_anchor","_font","text","container","anchor","createQuery","stage","query","selector","com","type","trim","includes","push","getTypedItem","get","parsed","parseStringQuery","map","item","findBy","key","value","find","REG_PROP","result","split","startsWith","slice","test","_a","source","filter","is","parsePropQuery","string","_","walk","children","length","child","array","_item","window","$"],"mappings":"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"}