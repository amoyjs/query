{"version":3,"file":"query.min.js","sources":["../lib/instance/index.ts","../lib/globals/use.ts","../lib/core/is.ts","../lib/core/createQuery.ts","../lib/core/index.ts","../lib/globals/extend.ts"],"sourcesContent":["/**\n * show\n * \n * show the selected item\n *\n * @module query/show\n *\n * @example\n *\n * $('text').show()\n */\nexport function show(this: any) {\n    for (let i = 0; i < this.length; i++) {\n        this[i].visible = true\n    }\n    return this\n}\n\n/**\n * hide\n *\n * hide the selected item\n *\n * @module query/hide\n *\n * @example\n *\n * $('text').hide()\n */\nexport function hide(this: any) {\n    for (let i = 0; i < this.length; i++) {\n        this[i].visible = false\n    }\n    return this\n}\n\n/**\n * get\n * \n * get item by index or get a collection for selected items\n * \n * @module query/get\n * \n * @param index\n *\n * @example\n *\n * $('text').get()\n * // or\n * $('text').get(0)\n */\nexport function get(this: any, index: number) {\n    if (index) {\n        return this[index]\n    } else {\n        const pure: any[] = []\n        for (let i = 0; i < this.length; i++) {\n            pure.push(this[i])\n        }\n        return pure\n    }\n}\n\n/**\n * width\n * \n * if param `width` is type of number,\n * `width()` will set selected items' width property\n * else return the first selected item's width value\n * \n * @module query/width\n * \n * @param { Number } width\n *\n * @example\n *\n * $('text').width()\n */\nexport function width(this: any, width: number) {\n    if (typeof width === 'number') {\n        for (let i = 0; i < this.length; i++) {\n            this[i].width = width\n        }\n    } else {\n        return this[0].width\n    }\n}\n\n/**\n * height\n *\n * if param `height` is type of number,\n * `height()` will set selected items' height property\n * else return the first selected item's height value\n * \n * @module query/height\n *\n * @param { Number } height\n *\n * @example\n *\n * $('text').height()\n */\nexport function height(this: any, height: number) {\n    if (typeof height === 'number') {\n        for (let i = 0; i < this.length; i++) {\n            this[i].height = height\n        }\n    } else {\n        return this[0].height\n    }\n}\n\n/**\n * position\n * \n * return the first selected item's coordanites\n * \n * @module query/position\n *\n * @example\n *\n * $('text').position()\n */\nexport function position(this: any) {\n    if (this[0]) {\n        return {\n            x: this[0].x,\n            y: this[0].y,\n        }\n    } else {\n        return null\n    }\n}\n\n/**\n * children\n * \n * return the first selected item's children\n * \n * @module query/children\n *\n * @example\n *\n * $('text').children()\n */\nexport function children(this: any) {\n    return this[0] ? this[0].children : []\n}\n\n/**\n * count\n * \n * return the selected items' count\n * \n * @module query/count\n *\n * @example\n *\n * $('text').count()\n */\nexport function count(this: any) {\n    return this.length\n}\n\n/**\n * first\n *\n * return the first selected item\n * \n * @module query/first\n *\n * @example\n *\n * $('text').first()\n *\n * @example\n *\n * $('text').first()\n */\nexport function first(this: any) {\n    return this[0]\n}\n\n/**\n * last\n *\n * return the last selected item\n * \n * @module query/last\n *\n * @example\n *\n * $('text').last()\n */\nexport function last(this: any) {\n    return this[this.length - 1]\n}\n\n/**\n * each\n * \n * @module query/each\n * \n * @param { Function } closure - executeable functoin\n *\n * @example\n *\n * $('text').each(item => {\n *     $(item).hide()\n * })\n */\nexport function each(this: any, closure: (item: any, index: number) => void) {\n    for (let i = 0; i < this.length; i++) {\n        closure(this[i], i)\n    }\n}\n\n/**\n * empty\n * \n * remove the selected items' children\n * \n * @module query/empty\n *\n * @example\n *\n * $('text').empty()\n */\nexport function empty(this: any) {\n    for (let i = 0; i < this.length; i++) {\n        this[i].removeChildren()\n    }\n}\n\n/**\n * parent\n * \n * if the first selected item's parent exist, return it, else return `null`\n * \n * @module query/parent\n * \n * @example\n * \n * $('text').parent()\n */\nexport function parent(this: any) {\n    return this[0] ? this[0].parent : null\n}\n\nexport function attr(this: any, key: string, value?: any) {\n    if (this[0] ) {  \n        if (value) {\n            this[0][key] = value\n            return this[0]\n        } else {\n            return this[0][key]\n        }\n    }\n}\n\nexport function text(this: any) {\n    if (this[0]) {\n        if (this[0].text) {\n            return this[0].text\n        } else if (this[0].children && this[0].children[0].text) {\n            return this[0].children[0].text\n        }\n    } else {\n        return null\n    }\n}\n\nexport function find() {\n    console.log('find() not support yet')\n}\n\nexport function prev(this: any) {\n    if (this[0] && this[0].parent && this[0].parent.children.length) {\n        return this[0].parent.children.filter((v, i) => {\n            if (v === this[0]) {\n                return this[0].parent.children[i - 1]\n            }\n        })[0]\n    }\n}\n\nexport function next(this: any) {\n    if (this[0] && this[0].parent && this[0].parent.children.length) {\n        return this[0].parent.children.filter((v, i) => {\n            if (v === this[0]) {\n                return this[0].parent.children[i + 1]\n            }\n        })[0]\n    }\n}\n","export const fns: any[] = []\n\nexport function use(fn: () => void) {\n    fns.push(fn)\n}\n","export function sprite(target: any) {\n    return typeof target._anchor !== 'undefined' && typeof target._font === 'undefined'\n}\n\nexport function text(target: any) {\n    return typeof target._font === 'string'\n}\n\nexport function container(target: any) {\n    return typeof target.anchor === 'undefined'\n}\n","import * as is from './is'\nimport { fns } from '../globals/use'\n\nexport function createQuery(stage: any, query: typeof $) {\n    return (selector: any) => {\n        const com: any[] = []\n        // @ts-ignore\n        const any = fns.reduce((prev: any, current: any) => current(prev, query), selector)\n        const type = typeof any\n\n        switch (type) {\n            case 'string':\n                selector = any.trim()\n                if (['container', 'sprite', 'text'].includes(selector)) {\n                    com.push(...getTypedItem(selector, get(stage)))\n                } else {\n                    const parsed = parseStringQuery(selector)\n                    parsed.map((item: any) => com.push(...findBy(item.key, item.value, get(stage))))\n                }\n                break\n            case 'object':\n                com.push(any)\n                break\n            default:\n                break\n        }\n\n        return Object.assign(com, query.prototype)\n    }\n}\n\nconst REG_PROP = /\\[(.*)\\=(.*)\\]/ // 匹配 `[${key}=${value}]` 形式字符串\n\nfunction parseStringQuery(query: string = '') {\n    const result: any[] = []\n    query.split(',').map((query: string) => {\n        query = query.trim()\n        const selectTypes = {\n            '#': ['id'],\n            '.': ['className', 'class', 'classname'],\n        }\n        for (const key in selectTypes) {\n            if (query.startsWith(key)) {\n                selectTypes[key].map((attrName) => {\n                    result.push({\n                        key: attrName,\n                        value: query.slice(1),\n                    })\n                })\n            }\n        }\n        if (REG_PROP.test(query)) {\n            const [key, value] = parsePropQuery(query)\n            result.push({\n                key,\n                value,\n            })\n        }\n    })\n    return result\n}\n\nfunction getTypedItem(type: string, source: any[]) {\n    return source.filter((item) => is[type](item))\n}\n\nfunction parsePropQuery(string: string) {\n    const [_, key, value] = string.match(REG_PROP) as any\n    return [key, value]\n}\n\nfunction get(object: any) {\n    const result: any[] = []\n    const walk = (object: any) => {\n        if (object.children.length > 0) {\n            result.push(...object.children)\n            object.children.map((child: any) => walk(child))\n        }\n    }\n    walk(object)\n    return result\n}\n\nfunction find(item: any, array: any[]) {\n    return array.filter((_item) => _item === item)\n}\n\nfunction findBy(key: string, value: any, array: any[]) {\n    return array.filter((item) => item[key] === value)\n}\n","import * as instance from '../instance'\nimport { use, extend } from '../globals'\nimport { createQuery } from './createQuery'\nimport queryEvent from '@amoy/query-event'\n\nexport const query = (stage: any) => window.$ = createQuery(stage, query)\nquery.use = use\nquery.extend = extend\n\nquery.extend([\n    queryEvent,\n    instance,\n])\n","/**\n * extend\n * \n * query extend method\n * \n * @module query/extend\n * \n * @param { Object | Array } target - extend target\n * \n * @example\n * \n * import query from '@amoy/query'\n * \n * query.extend({\n *     hide() {\n *         for (let i = 0; i < this.length; i++) {\n *             // hide all the selected items\n *             this[i].visible = false\n *         }\n *     },\n * })\n * \n * $('some query').hide()\n */\nexport function extend(this: any, target: any = []) {\n    if (Array.isArray(target)) {\n        target.map((item) => extend.bind(this)(item))\n    } else if (typeof target === 'object') {\n        Object.assign(this.prototype, target)\n    } else {\n        console.error(`query extension's type must be \"object\" or \"object[]\"`)\n    }\n}\n"],"names":["i","this","length","visible","index","pure","push","width","height","x","y","children","closure","removeChildren","parent","key","value","text","console","log","filter","v","_this","fns","target","_anchor","_font","anchor","createQuery","stage","query","selector","com","any","reduce","prev","current","trim","includes","type","source","item","is","getTypedItem","get","result","split","map","selectTypes","#",".","startsWith","attrName","slice","REG_PROP","test","_a","string","parseStringQuery","array","findBy","Object","assign","prototype","object","walk","child","window","$","use","fn","extend","Array","isArray","bind","error","queryEvent","instance"],"mappings":"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"}