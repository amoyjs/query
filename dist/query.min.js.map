{"version":3,"file":"query.min.js","sources":["../src/instance/index.ts","../src/globals/extend.ts","../src/core/createQuery.ts","../src/core/index.ts","../src/globals/use.ts","../src/core/is.ts"],"sourcesContent":["/**\n * show\n * \n * show the selected item\n *\n * @module query/show\n *\n * @example\n *\n * $('text').show()\n */\nexport function show() {\n    for (let i = 0; i < this.length; i++) {\n        this[i].visible = true\n    }\n    return this\n}\n\n/**\n * hide\n *\n * hide the selected item\n *\n * @module query/hide\n *\n * @example\n *\n * $('text').hide()\n */\nexport function hide() {\n    for (let i = 0; i < this.length; i++) {\n        this[i].visible = false\n    }\n    return this\n}\n\n/**\n * get\n * \n * get item by index or get a collection for selected items\n * \n * @module query/get\n * \n * @param index\n *\n * @example\n *\n * $('text').get()\n * // or\n * $('text').get(0)\n */\nexport function get(index: number) {\n    if (index) {\n        return this[index]\n    } else {\n        const pure = []\n        for (let i = 0; i < this.length; i++) {\n            pure.push(this[i])\n        }\n        return pure\n    }\n}\n\n/**\n * width\n * \n * if param `width` is type of number,\n * `width()` will set selected items' width property\n * else return the first selected item's width value\n * \n * @module query/width\n * \n * @param { Number } width\n *\n * @example\n *\n * $('text').width()\n */\nexport function width(width: number) {\n    if (typeof width === 'number') {\n        for (let i = 0; i < this.length; i++) {\n            this[i].width = width\n        }\n    } else {\n        return this[0].width\n    }\n}\n\n/**\n * height\n *\n * if param `height` is type of number,\n * `height()` will set selected items' height property\n * else return the first selected item's height value\n * \n * @module query/height\n *\n * @param { Number } height\n *\n * @example\n *\n * $('text').height()\n */\nexport function height(height: number) {\n    if (typeof height === 'number') {\n        for (let i = 0; i < this.length; i++) {\n            this[i].height = height\n        }\n    } else {\n        return this[0].height\n    }\n}\n\n/**\n * position\n * \n * return the first selected item's coordanites\n * \n * @module query/position\n *\n * @example\n *\n * $('text').position()\n */\nexport function position() {\n    return {\n        x: this[0] ? this[0].x : 0,\n        y: this[0] ? this[0].y : 0,\n    }\n}\n\n/**\n * children\n * \n * return the first selected item's children\n * \n * @module query/children\n *\n * @example\n *\n * $('text').children()\n */\nexport function children() {\n    return this[0] ? this[0].children : []\n}\n\n/**\n * count\n * \n * return the selected items' count\n * \n * @module query/count\n *\n * @example\n *\n * $('text').count()\n */\nexport function count() {\n    return this.length\n}\n\n/**\n * first\n *\n * return the first selected item\n * \n * @module query/first\n *\n * @example\n *\n * $('text').first()\n *\n * @example\n *\n * $('text').first()\n */\nexport function first() {\n    return this[0]\n}\n\n/**\n * last\n *\n * return the last selected item\n * \n * @module query/last\n *\n * @example\n *\n * $('text').last()\n */\nexport function last() {\n    return this[this.length - 1]\n}\n\n/**\n * each\n * \n * @module query/each\n * \n * @param { Function } closure - executeable functoin\n *\n * @example\n *\n * $('text').each(item => {\n *     $(item).hide()\n * })\n */\nexport function each(closure: (item: any, index: number) => void) {\n    for (let i = 0; i < this.length; i++) {\n        closure(this[i], i)\n    }\n}\n\n/**\n * empty\n * \n * remove the selected items' children\n * \n * @module query/empty\n *\n * @example\n *\n * $('text').empty()\n */\nexport function empty() {\n    for (let i = 0; i < this.length; i++) {\n        this[i].removeChildren()\n    }\n}\n\n/**\n * parent\n * \n * if the first selected item's parent exist, return it, else return `null`\n * \n * @module query/parent\n * \n * @example\n * \n * $('text').parent()\n */\nexport function parent() {\n    return this[0] ? this[0].parent : null\n}\n\nexport function text() {\n    console.log('text() not support yet')\n    return this[0] && this[0]._text && this[0]._text\n}\n\nexport function css() {\n    console.log('css() not support yet')\n}\n\nexport function find() {\n    console.log('find() not support yet')\n}\n\nexport function offset() {\n    console.log('offset() not support yet')\n}\n\nexport function prev() {\n    console.log('prev() not support yet')\n}\n\nexport function next() {\n    console.log('next() not support yet')\n}\n\n","/**\n * extend\n * \n * query extend method\n * \n * @module query/extend\n * \n * @param { Object | Array } target - extend target\n * \n * @example\n * \n * import query from '@amoy/query'\n * \n * query.extend({\n *     hide() {\n *         for (let i = 0; i < this.length; i++) {\n *             // hide all the selected items\n *             this[i].visible = false\n *         }\n *     },\n * })\n * \n * $('some query').hide()\n */\nexport function extend(target: any = []) {\n    if (Array.isArray(target)) {\n        target.map((item) => extend.bind(this)(item))\n    } else if (typeof target === 'object') {\n        Object.assign(this.prototype, target)\n    } else {\n        console.error(`query extension's type must be \"object\" or \"object[]\"`)\n    }\n}","import * as is from './is'\nimport { fns } from '../globals/use'\nimport { IQuery } from '../types'\n\nexport function createQuery(stage: any, query: IQuery) {\n    return (selector: any) => {\n        const com = []\n        // @ts-ignore\n        const any = fns.reduce((prev: any, current: any) => current(prev, query), selector)\n        const type = typeof any\n\n        switch (type) {\n            case 'string':\n                selector = any.trim()\n                if (['container', 'sprite', 'text'].includes(selector)) {\n                    com.push(...getTypedItem(selector, get(stage)))\n                } else {\n                    const parsed = parseStringQuery(selector)\n                    parsed.map((item) => com.push(...findBy(item.key, item.value, get(stage))))\n                }\n                break\n            case 'object':\n                com.push(any)\n                break\n            default:\n                break\n        }\n\n        return Object.assign(com, query.prototype)\n    }\n}\n\nconst REG_PROP = /\\[(.*)\\=(.*)\\]/ // 匹配 `[${key}=${value}]` 形式字符串\n\nfunction parseStringQuery(query: string = '') {\n    const result = []\n    query.split(',').map((query: string) => {\n        query = query.trim()\n        const selectTypes = {\n            '#': 'id',\n            '.': 'className',\n        }\n        for (const key in selectTypes) {\n            if (query.startsWith(key)) {\n                result.push({\n                    key: selectTypes[key],\n                    value: query.slice(1),\n                })\n            }\n        }\n        if (REG_PROP.test(query)) {\n            const [key, value] = parsePropQuery(query)\n            result.push({\n                key,\n                value,\n            })\n        }\n    })\n    return result\n}\n\nfunction getTypedItem(type: string, source: any[]) {\n    return source.filter((item) => is[type](item))\n}\n\nfunction parsePropQuery(string: string) {\n    const [_, key, value] = string.match(REG_PROP)\n    return [key, value]\n}\n\nfunction get(object: any) {\n    const result = []\n    const walk = (object: any) => {\n        if (object.children.length > 0) {\n            result.push(...object.children)\n            object.children.map((child: any) => walk(child))\n        }\n    }\n    walk(object)\n    return result\n}\n\nfunction find(item: any, array: any[]) {\n    return array.filter((_item) => _item === item)\n}\n\nfunction findBy(key: string, value: any, array: any[]) {\n    return array.filter((item) => item[key] === value)\n}","import * as instance from '../instance'\nimport { use, extend } from '../globals'\nimport { createQuery } from './createQuery'\nimport queryEvent from '@amoy/query-event'\nimport { IQuery } from '../types'\n\n/**\n * query\n * \n * @module query/query\n * \n * @param { Object } stage - PIXI stage\n * \n * @example\n * \n * import { Application as Game } from 'pixi.js'\n * \n * const game = new Game({\n *     width: window.innerWidth,\n *     height: window.innerHeight,\n * })\n * \n * query(game.stage)\n * //then you can use as\n * $('sprite').hide()\n * // or\n * $('text').on('tap', () => {})\n */\n// @ts-ignore\nexport const query: IQuery = (stage: any) => window.$ = createQuery(stage, query)\n\nquery.use = use\nquery.extend = extend\n\nquery.extend([\n    queryEvent,\n    instance,\n])","export const fns = []\n\nexport function use(fn: () => void) {\n    fns.push(fn)\n}","export function sprite(target: any) {\n    return typeof target._anchor !== 'undefined' && typeof target._font === 'undefined'\n}\n\nexport function text(target: any) {\n    return typeof target._font === 'string'\n}\n\nexport function container(target: any) {\n    return typeof target.anchor === 'undefined'\n}"],"names":["width","i","length","height","extend","target","Array","isArray","map","item","bind","_this","Object","assign","prototype","console","error","createQuery","stage","query","selector","com","any","fns","reduce","prev","current","trim","includes","push","getTypedItem","get","parsed","parseStringQuery","findBy","key","value","result","split","selectTypes","startsWith","slice","REG_PROP","test","_a","type","source","filter","is","parsePropQuery","string","_","object","walk","children","child","array","visible","index","pure","x","y","closure","removeChildren","parent","log","_text","_anchor","_font","anchor","window","$","use","fn","queryEvent","instance"],"mappings":"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"}