{"version":3,"file":"query-event.js","sources":["../src/touch/eventBus.ts","../node_modules/@amoy/common/dist/common.es.js","../src/common/index.ts","../src/touch/utils.ts","../src/touch/index.ts","../src/index.ts"],"sourcesContent":["import { QueryEvent } from '../types'\n\nexport default class EventBus {\n    private handlers: QueryEvent.Handler[] = []\n    public add(handler: QueryEvent.Handler) {\n        this.handlers.push(handler)\n        return this\n    }\n    public del(handler: QueryEvent.Handler) {\n        if (!handler) {\n            this.handlers = []\n        } else {\n            this.handlers.map((value, index) => {\n                value === handler && this.handlers.splice(index, 1)\n            })\n        }\n        return this\n    }\n    public fire(evObj: QueryEvent.RTouchEvent) {\n        if (!this.handlers || !this.handlers.length) return\n        this.handlers.map((handler) => {\n            if (typeof handler === 'function') handler(evObj)\n        })\n        return this\n    }\n    public clear() {\n        this.handlers = []\n    }\n}\n","function type(object) {\n    var class2type = {};\n    var type = class2type.toString.call(object);\n    var typeString = 'Boolean Number String Function Array Date RegExp Object Error Symbol';\n    if (object == null)\n        return object + '';\n    typeString.split(' ').forEach(function (type) {\n        class2type[\"[object \" + type + \"]\"] = type.toLowerCase();\n    });\n    var isObject = typeof object === 'object';\n    var isFn = typeof object === 'function';\n    return isObject || isFn ? class2type[type] || 'object' : typeof object;\n}\nfunction isPlainObject(object) {\n    var class2type = {};\n    var toString = class2type.toString;\n    var hasOwn = class2type.hasOwnProperty;\n    var fnToString = hasOwn.toString;\n    var ObjectFunctionString = fnToString.call(Object);\n    var prototype, ctor;\n    if (!object || toString.call(object) !== '[object Object]') {\n        return false;\n    }\n    prototype = Object.getPrototypeOf(object);\n    if (!prototype)\n        return true;\n    ctor = hasOwn.call(prototype, 'constructor') && prototype.constructor;\n    return typeof ctor === 'function' && fnToString.call(ctor) === ObjectFunctionString;\n}\nfunction extend() {\n    var args = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n    }\n    var options, name, clone, copy, source, copyIsArray, target = arguments[0] || {}, i = 1, length = arguments.length, deep = false;\n    if (typeof target === 'boolean') {\n        deep = target;\n        target = arguments[i] || {};\n        i++;\n    }\n    if (typeof target !== 'object' && type(target) !== 'function') {\n        target = {};\n    }\n    if (i === length) {\n        target = this;\n        i--;\n    }\n    for (; i < length; i++) {\n        //\n        if ((options = arguments[i]) !== null) {\n            // for in source object\n            for (name in options) {\n                source = target[name];\n                copy = options[name];\n                if (target == copy) {\n                    continue;\n                }\n                // deep clone\n                if (deep && copy && (isPlainObject(copy) || (copyIsArray = Array.isArray(copy)))) {\n                    // if copy is array\n                    if (copyIsArray) {\n                        copyIsArray = false;\n                        // if is not array, set it to array\n                        clone = source && Array.isArray(source) ? source : [];\n                    }\n                    else {\n                        // if copy is not a object, set it to object\n                        clone = source && isPlainObject(source) ? source : {};\n                    }\n                    target[name] = extend(deep, clone, copy);\n                }\n                else if (copy !== undefined) {\n                    target[name] = copy;\n                }\n            }\n        }\n    }\n    return target;\n}\n\nexport { extend, isPlainObject, type };\n//# sourceMappingURL=common.es.js.map\n","import { type } from '@amoy/common'\n\nexport const get = (root: any, get: string) => {\n    if (type(root) !== 'object') return root\n    let value = root\n    const keyArr = get.split('.')\n    for (let i = 0, l = keyArr.length; i < l; i++) {\n        const v = keyArr[i]\n        if (v) {\n            if (value[v]) {\n                value = value[v]\n            } else {\n                value = undefined\n                break\n            }\n        }\n    }\n    return value\n}","import { QueryEvent } from '../types'\nimport { get } from '../common'\n\nexport default {\n    getFingers(ev: QueryEvent.PixiEvent) {\n        return get(ev, 'data.originalEvent.touches.length') || 1\n    },\n    getPoint(ev: QueryEvent.PixiEvent, index: 0 | 1) {\n        if (ev.data.pointerType === 'touch') {\n            const touches = ev.data.originalEvent.touches\n            return {\n                x: Math.round(touches[index].pageX),\n                y: Math.round(touches[index].pageY),\n            }\n        } else {\n            return {\n                x: Math.round(ev.data.global.x),\n                y: Math.round(ev.data.global.y),\n            }\n        }\n    },\n    getVector(p1: QueryEvent.Point, p2: QueryEvent.Point) {\n        const x = Math.round(p1.x - p2.x)\n        const y = Math.round(p1.y - p2.y)\n        return { x, y }\n    },\n    getLength(v1: QueryEvent.Point) {\n        return Math.sqrt(v1.x * v1.x + v1.y * v1.y)\n    },\n    getAngle(v1: QueryEvent.Point, v2: QueryEvent.Point) {\n        if (typeof v1 !== 'object' || typeof v2 !== 'object') {\n            console.error('getAngle error!')\n            return\n        }\n        // 判断方向，顺时针为 1 ,逆时针为 -1；\n        const direction = v1.x * v2.y - v2.x * v1.y > 0 ? 1 : -1\n            // 两个向量的模；\n        const len1 = this.getLength(v1)\n        const len2 = this.getLength(v2)\n        const mr = len1 * len2\n        let dot\n        let r\n        if (mr === 0)return 0\n        // 通过数量积公式可以推导出：\n        // cos = (x1 * x2 + y1 * y2)/(|a| * |b|);\n        dot = v1.x * v2.x + v1.y * v2.y\n        r = dot / mr\n        if (r > 1)r = 1\n        if (r < -1)r = -1\n        // 解值并结合方向转化为角度值；\n        return Math.acos(r) * direction\n    },\n    getAnchorPoint(target: any) {\n        return {\n            x: target.x,\n            y: target.y,\n        }\n    },\n}","import * as PIXI from 'pixi.js'\nimport { QueryEvent } from '../types'\nimport EventBus from './eventBus'\nimport u from './utils'\n\nexport const RTOUCH_SUPPORT_EVENT = [\n    'touchstart',\n    'touchmove',\n    'touchend',\n    // 拖动\n    'drag',\n    'dragstart',\n    'dragend',\n    // 双指缩放\n    'pinch',\n    'pinchstart',\n    'pinchend',\n    // 双指旋转\n    'rotate',\n    'rotatestart',\n    'rotateend',\n    // 划动\n    'swipeleft',\n    'swiperight',\n    'swipeup',\n    'swipedown',\n    // 短点击\n    'shorttap',\n    'longtap',\n    // 单指缩放\n    'singlepinch',\n    'singlepinchstart',\n    'singlepinchend',\n    // 单指旋转\n    'singlerotate',\n    'singlerotatestart',\n    'singlerotateend',\n]\n\n// 挟持的原生事件\nconst ORIGIN_EVENT_MAP = [{\n    name: 'pointerdown',\n    fn: '_start',\n}, {\n    name: 'pointermove',\n    fn: '_move',\n}, {\n    name: 'pointerup',\n    fn: '_end',\n}, {\n    name: 'pointerupoutside',\n    fn: '_end',\n}]\n\n// 事件中心\n\nexport default class RTouch {\n    // 精灵\n    private target: PIXI.Sprite | PIXI.Graphics | PIXI.Text\n    // 触摸手指数量\n    private fingers: number = 0\n    // 第一触控点\n    private swipeStartPoint: QueryEvent.Point | null\n    private startPoint: QueryEvent.Point | null\n    private startTime: number\n    // 第二触控点\n    private secondPoint: QueryEvent.Point | null\n    // 初始向量\n    private vector1: QueryEvent.Point | null\n    // 初始向量模\n    private pinchStartLength: number | null\n    // 是否开始触摸\n    // 用于解决 精灵区域外 move 也被触发的问题\n    private touching: boolean = false\n    private singleBasePoint: QueryEvent.Point\n    private singlePinchStartLength: number\n    private Bus: {\n        [evName: string]: EventBus,\n    } = {}\n    constructor(target: PIXI.Sprite | PIXI.Graphics | PIXI.Text) {\n        this.target = target\n        // 初始化事件中心\n        this.initEventBus()\n        // 事件挟持\n        this.bindOriginEvent()\n    }\n    private initEventBus() {\n        RTOUCH_SUPPORT_EVENT.map((evName: string) => {\n            Object.defineProperty(this.Bus, evName, { value: new EventBus() })\n        })\n    }\n    private bindOriginEvent() {\n        ORIGIN_EVENT_MAP.map(({name, fn}) => {\n            this.target.interactive = true\n            this.target.on(name, this[fn], this)\n        })\n    }\n    public _start(ev: QueryEvent.PixiEvent) {\n        this.touching = true\n        this.startTime = Date.now()\n        this.fingers = u.getFingers(ev)\n        this.singleBasePoint = u.getAnchorPoint(this.target)\n        // 记录第一触控点\n        this.swipeStartPoint = this.startPoint = u.getPoint(ev, 0)\n\n        if (this.fingers === 1) {\n            // 单指且监听 singlePinch 时，计算向量模；\n            const startVector = u.getVector(this.startPoint, this.singleBasePoint)\n            this.singlePinchStartLength = u.getLength(startVector)\n        } else if (this.fingers > 1) {\n            // 双指操作时，记录第二触控点\n            this.secondPoint = u.getPoint(ev, 1)\n            // 计算双指向量；\n            this.vector1 = u.getVector(this.secondPoint, this.startPoint)\n            // 计算向量模\n            this.pinchStartLength = u.getLength(this.vector1)\n        }\n\n        this.fireEvent('touchstart', {\n            origin: ev,\n        })\n    }\n    public _move(ev: QueryEvent.PixiEvent) {\n        if (!this.touching) return\n        const curPoint = u.getPoint(ev, 0)\n        // 判断触控区域是否为单指操作的按钮\n        // const isSingleButton = ev.tapTarget.name === 'singlebutton'\n        const isSingleButton = false\n        if (!this.startPoint) this.startPoint = curPoint\n        if (this.fingers > 1) {\n            // 双指操作， 触发 pinch 与 rotate\n            const curSecPoint = u.getPoint(ev, 1)\n            const vector2 = u.getVector(curSecPoint, curPoint)\n            const pinchLength = u.getLength(vector2)\n\n            if (this.pinchStartLength) {\n                this.eventStart('pinch', {\n                    origin: ev,\n                    delta: {\n                        scale: pinchLength / this.pinchStartLength,\n                    },\n                })\n                this.pinchStartLength = pinchLength\n            }\n\n            if (this.vector1) {\n                this.eventStart('rotate', {\n                    delta: {\n                        rotate: u.getAngle(this.vector1, vector2),\n                    },\n                    origin: ev,\n                })\n                this.vector1 = vector2\n            }\n        } else {\n            // 触发 单指缩放\n            if (isSingleButton) {\n                const pinchV2 = u.getVector(curPoint, this.singleBasePoint)\n                const singlePinchLength = u.getLength(pinchV2)\n\n                this.eventStart('singlepinch', {\n                    delta: {\n                        scale: singlePinchLength / this.singlePinchStartLength,\n                        deltaX: curPoint.x - this.startPoint.x,\n                        deltaY: curPoint.y - this.startPoint.y,\n                    },\n                    origin: ev,\n                })\n                this.singlePinchStartLength = singlePinchLength\n            }\n            // 触发 单指旋转;\n            if (isSingleButton) {\n                const rotateV1 = u.getVector(this.startPoint, this.singleBasePoint)\n                const rotateV2 = u.getVector(curPoint, this.singleBasePoint)\n\n                this.eventStart('singlerotate', {\n                    delta: {\n                        rotate: u.getAngle(rotateV1, rotateV2),\n                    },\n                    origin: ev,\n                })\n            }\n        }\n\n        // 触发 drag\n        this.eventStart('drag', {\n            delta: {\n                x: curPoint.x - this.startPoint.x,\n                y: curPoint.y - this.startPoint.y,\n            },\n            origin: ev,\n        })\n\n        this.fireEvent('touchmove', {\n            origin: ev,\n        })\n\n        this.startPoint = curPoint\n    }\n    public _end(ev: QueryEvent.PixiEvent) {\n        const evArr = ['pinch', 'drag', 'rotate', 'singlerotate', 'singlepinch']\n        this.touching = false\n        this.fingers = u.getFingers(ev)\n\n        evArr.map((evName: string) => {\n            this.eventEnd(evName, {\n                origin: ev,\n                type: evName,\n            })\n        })\n\n        if (this.swipeStartPoint) {\n            const endPoint = {\n                x: Math.round(ev.data.global.x),\n                y: Math.round(ev.data.global.y),\n            }\n            const deltaX = endPoint.x - this.swipeStartPoint.x\n            const deltaY = endPoint.y - this.swipeStartPoint.y\n            const endTime = Date.now()\n            let eventType: string = ''\n            if (deltaX > 30 && Math.abs(deltaY) < 100) {\n                // 右划\n                eventType = 'swiperight'\n            } else if (deltaX < -30 && Math.abs(deltaY) < 100) {\n                // 左划\n                eventType = 'swipeleft'\n            } else if (deltaY > 30 && Math.abs(deltaX) < 100) {\n                // 下划\n                eventType = 'swipedown'\n            } else if (deltaY < -30 && Math.abs(deltaX) < 100) {\n                // 上划\n                eventType = 'swipeup'\n            } else if (Math.abs(deltaX) < 30 && Math.abs(deltaY) < 30 ) {\n                if (endTime - this.startTime < 500) {\n                    // 触发短点击\n                    eventType = 'shorttap'\n                } else {\n                    // 触发长按\n                    eventType = 'longtap'\n                }\n            }\n\n            if (eventType) {\n                this.fireEvent(eventType, {\n                    origin: ev,\n                })\n            }\n        }\n\n        this.fireEvent('touchend', {\n            origin: ev,\n        })\n    }\n    private fireEvent(evName: string, ev: {\n        origin: QueryEvent.PixiEvent,\n        [any: string]: any,\n    }) {\n        if (this.Bus[evName]) {\n            this.Bus[evName].fire(Object.assign(ev, {\n                type: evName,\n                stopPropagation() {\n                    ev.origin.stopPropagation()\n                },\n            }))\n        }\n    }\n    public destory() {\n        ORIGIN_EVENT_MAP.map(({name, fn}) => {\n            this.target.off(name, this[fn], this)\n        })\n    }\n\n    private eventStart(evName: string, ev: {\n        origin: QueryEvent.PixiEvent,\n        [any: string]: any,\n    }) {\n        const ing = `${evName}ing`\n        const start = `${evName}start`\n        if (!this[ing]) {\n            this.fireEvent(start, ev)\n            this[ing] = true\n        } else {\n            this.fireEvent(evName, ev)\n        }\n    }\n\n    private eventEnd(evName: string, ev: QueryEvent.RTouchEvent) {\n        const ing = `${evName}ing`\n        const end = `${evName}end`\n        if (this[ing]) {\n            ev.type = end\n            this.fireEvent(end, ev)\n            this[ing] = false\n        }\n    }\n\n    public on(evName: string, handler: QueryEvent.Handler) {\n        const _evName = evName.trim().toLowerCase()\n        _evName.split(' ').map((name: string) => {\n            this.Bus[name].add(handler)\n        })\n        return this\n    }\n\n    public off(evName: string, handler?: QueryEvent.Handler) {\n        const _evName = evName.trim().toLowerCase()\n        _evName.split(' ').map((name: string) => {\n            handler ? this.Bus[name].del(handler) : this.Bus[name].clear()\n        })\n        return this\n    }\n}","import { QueryEvent } from './types'\nimport RTouch, { RTOUCH_SUPPORT_EVENT } from './touch';\n\ntype callback = (ev: QueryEvent.RTouchEvent) => void\n\nfunction bind(target: any, evName: string, fn: callback) {\n    if (RTOUCH_SUPPORT_EVENT.includes(evName)) {\n        if (!target['RTouch']) target['RTouch'] = new RTouch(target)\n        target['RTouch'].on(evName, fn)\n    } else {\n        target.interactive = true\n        target.on(evName, fn)\n    }\n}\n\nfunction off(target: any, evName: string, fn?: callback) {\n    if (RTOUCH_SUPPORT_EVENT.includes(evName) && target['RTouch']) {\n        target['RTouch'].off(evName, fn)\n    } else {\n        target.interactive = true\n        target.off(evName, fn)\n    }\n}\n\nexport const event = {\n    on(name: string = '', closure: () => void = () => { }) {\n        const events = name.split(' ')\n        for (let i = 0; i < this.length; i++) {\n            for (let j = 0; j < events.length; j++) {\n                this[i].interactive = true\n                bind(this[i], events[j], closure)\n            }\n        }\n        return this\n    },\n    off(name: string = '') {\n        const events = name.split(' ')\n        for (let i = 0; i < this.length; i++) {\n            for (let j = 0; j < events.length; j++) {\n                this[i].off(events[j])\n                off(this[i], events[j])\n            }\n        }\n        return this\n    }\n}\n\nexport default event\n\n// @ts-ignore\nif (window.query) window.query.extend(event)"],"names":[],"mappings":";;;;;;IAEA;QAAA;YACY,aAAQ,GAAyB,EAAE,CAAA;SAyB9C;QAxBU,sBAAG,GAAV,UAAW,OAA2B;YAClC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA;YAC3B,OAAO,IAAI,CAAA;SACd;QACM,sBAAG,GAAV,UAAW,OAA2B;YAAtC,iBASC;YARG,IAAI,CAAC,OAAO,EAAE;gBACV,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAA;aACrB;iBAAM;gBACH,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,UAAC,KAAK,EAAE,KAAK;oBAC3B,KAAK,KAAK,OAAO,IAAI,KAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAA;iBACtD,CAAC,CAAA;aACL;YACD,OAAO,IAAI,CAAA;SACd;QACM,uBAAI,GAAX,UAAY,KAA6B;YACrC,IAAI,CAAC,IAAI,CAAC,QAAQ,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM;gBAAE,OAAM;YACnD,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,UAAC,OAAO;gBACtB,IAAI,OAAO,OAAO,KAAK,UAAU;oBAAE,OAAO,CAAC,KAAK,CAAC,CAAA;aACpD,CAAC,CAAA;YACF,OAAO,IAAI,CAAA;SACd;QACM,wBAAK,GAAZ;YACI,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAA;SACrB;QACL,eAAC;IAAD,CAAC,IAAA;;IC5BD,SAAS,IAAI,CAAC,MAAM,EAAE;IACtB,IAAI,IAAI,UAAU,GAAG,EAAE,CAAC;IACxB,IAAI,IAAI,IAAI,GAAG,UAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;IAChD,IAAI,IAAI,UAAU,GAAG,sEAAsE,CAAC;IAC5F,IAAI,IAAI,MAAM,IAAI,IAAI;IACtB,QAAQ,OAAO,MAAM,GAAG,EAAE,CAAC;IAC3B,IAAI,UAAU,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,UAAU,IAAI,EAAE;IAClD,QAAQ,UAAU,CAAC,UAAU,GAAG,IAAI,GAAG,GAAG,CAAC,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC;IACjE,KAAK,CAAC,CAAC;IACP,IAAI,IAAI,QAAQ,GAAG,OAAO,MAAM,KAAK,QAAQ,CAAC;IAC9C,IAAI,IAAI,IAAI,GAAG,OAAO,MAAM,KAAK,UAAU,CAAC;IAC5C,IAAI,OAAO,QAAQ,IAAI,IAAI,GAAG,UAAU,CAAC,IAAI,CAAC,IAAI,QAAQ,GAAG,OAAO,MAAM,CAAC;IAC3E,CAAC;;ICVM,IAAM,GAAG,GAAG,UAAC,IAAS,EAAE,GAAW;QACtC,IAAI,IAAI,CAAC,IAAI,CAAC,KAAK,QAAQ;YAAE,OAAO,IAAI,CAAA;QACxC,IAAI,KAAK,GAAG,IAAI,CAAA;QAChB,IAAM,MAAM,GAAG,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAA;QAC7B,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE;YAC3C,IAAM,CAAC,GAAG,MAAM,CAAC,CAAC,CAAC,CAAA;YACnB,IAAI,CAAC,EAAE;gBACH,IAAI,KAAK,CAAC,CAAC,CAAC,EAAE;oBACV,KAAK,GAAG,KAAK,CAAC,CAAC,CAAC,CAAA;iBACnB;qBAAM;oBACH,KAAK,GAAG,SAAS,CAAA;oBACjB,MAAK;iBACR;aACJ;SACJ;QACD,OAAO,KAAK,CAAA;IAChB,CAAC,CAAA;;ACfD,YAAe;QACX,UAAU,EAAV,UAAW,EAAwB;YAC/B,OAAO,GAAG,CAAC,EAAE,EAAE,mCAAmC,CAAC,IAAI,CAAC,CAAA;SAC3D;QACD,QAAQ,EAAR,UAAS,EAAwB,EAAE,KAAY;YAC3C,IAAI,EAAE,CAAC,IAAI,CAAC,WAAW,KAAK,OAAO,EAAE;gBACjC,IAAM,OAAO,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,OAAO,CAAA;gBAC7C,OAAO;oBACH,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,KAAK,CAAC;oBACnC,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,KAAK,CAAC;iBACtC,CAAA;aACJ;iBAAM;gBACH,OAAO;oBACH,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;oBAC/B,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;iBAClC,CAAA;aACJ;SACJ;QACD,SAAS,EAAT,UAAU,EAAoB,EAAE,EAAoB;YAChD,IAAM,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,CAAA;YACjC,IAAM,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,CAAA;YACjC,OAAO,EAAE,CAAC,GAAA,EAAE,CAAC,GAAA,EAAE,CAAA;SAClB;QACD,SAAS,EAAT,UAAU,EAAoB;YAC1B,OAAO,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,CAAA;SAC9C;QACD,QAAQ,EAAR,UAAS,EAAoB,EAAE,EAAoB;YAC/C,IAAI,OAAO,EAAE,KAAK,QAAQ,IAAI,OAAO,EAAE,KAAK,QAAQ,EAAE;gBAClD,OAAO,CAAC,KAAK,CAAC,iBAAiB,CAAC,CAAA;gBAChC,OAAM;aACT;;YAED,IAAM,SAAS,GAAG,EAAE,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAA;;YAExD,IAAM,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,CAAA;YAC/B,IAAM,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,CAAA;YAC/B,IAAM,EAAE,GAAG,IAAI,GAAG,IAAI,CAAA;YACtB,IAAI,GAAG,CAAA;YACP,IAAI,CAAC,CAAA;YACL,IAAI,EAAE,KAAK,CAAC;gBAAC,OAAO,CAAC,CAAA;;;YAGrB,GAAG,GAAG,EAAE,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC,CAAA;YAC/B,CAAC,GAAG,GAAG,GAAG,EAAE,CAAA;YACZ,IAAI,CAAC,GAAG,CAAC;gBAAC,CAAC,GAAG,CAAC,CAAA;YACf,IAAI,CAAC,GAAG,CAAC,CAAC;gBAAC,CAAC,GAAG,CAAC,CAAC,CAAA;;YAEjB,OAAO,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,SAAS,CAAA;SAClC;QACD,cAAc,EAAd,UAAe,MAAW;YACtB,OAAO;gBACH,CAAC,EAAE,MAAM,CAAC,CAAC;gBACX,CAAC,EAAE,MAAM,CAAC,CAAC;aACd,CAAA;SACJ;KACJ,CAAA;;ICrDM,IAAM,oBAAoB,GAAG;QAChC,YAAY;QACZ,WAAW;QACX,UAAU;;QAEV,MAAM;QACN,WAAW;QACX,SAAS;;QAET,OAAO;QACP,YAAY;QACZ,UAAU;;QAEV,QAAQ;QACR,aAAa;QACb,WAAW;;QAEX,WAAW;QACX,YAAY;QACZ,SAAS;QACT,WAAW;;QAEX,UAAU;QACV,SAAS;;QAET,aAAa;QACb,kBAAkB;QAClB,gBAAgB;;QAEhB,cAAc;QACd,mBAAmB;QACnB,iBAAiB;KACpB,CAAA;IAED;IACA,IAAM,gBAAgB,GAAG,CAAC;YACtB,IAAI,EAAE,aAAa;YACnB,EAAE,EAAE,QAAQ;SACf,EAAE;YACC,IAAI,EAAE,aAAa;YACnB,EAAE,EAAE,OAAO;SACd,EAAE;YACC,IAAI,EAAE,WAAW;YACjB,EAAE,EAAE,MAAM;SACb,EAAE;YACC,IAAI,EAAE,kBAAkB;YACxB,EAAE,EAAE,MAAM;SACb,CAAC,CAAA;IAEF;IAEA;QAuBI,gBAAY,MAA+C;;YAnBnD,YAAO,GAAW,CAAC,CAAA;;;YAanB,aAAQ,GAAY,KAAK,CAAA;YAGzB,QAAG,GAEP,EAAE,CAAA;YAEF,IAAI,CAAC,MAAM,GAAG,MAAM,CAAA;;YAEpB,IAAI,CAAC,YAAY,EAAE,CAAA;;YAEnB,IAAI,CAAC,eAAe,EAAE,CAAA;SACzB;QACO,6BAAY,GAApB;YAAA,iBAIC;YAHG,oBAAoB,CAAC,GAAG,CAAC,UAAC,MAAc;gBACpC,MAAM,CAAC,cAAc,CAAC,KAAI,CAAC,GAAG,EAAE,MAAM,EAAE,EAAE,KAAK,EAAE,IAAI,QAAQ,EAAE,EAAE,CAAC,CAAA;aACrE,CAAC,CAAA;SACL;QACO,gCAAe,GAAvB;YAAA,iBAKC;YAJG,gBAAgB,CAAC,GAAG,CAAC,UAAC,EAAU;oBAAT,cAAI,EAAE,UAAE;gBAC3B,KAAI,CAAC,MAAM,CAAC,WAAW,GAAG,IAAI,CAAA;gBAC9B,KAAI,CAAC,MAAM,CAAC,EAAE,CAAC,IAAI,EAAE,KAAI,CAAC,EAAE,CAAC,EAAE,KAAI,CAAC,CAAA;aACvC,CAAC,CAAA;SACL;QACM,uBAAM,GAAb,UAAc,EAAwB;YAClC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAA;YACpB,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,GAAG,EAAE,CAAA;YAC3B,IAAI,CAAC,OAAO,GAAG,CAAC,CAAC,UAAU,CAAC,EAAE,CAAC,CAAA;YAC/B,IAAI,CAAC,eAAe,GAAG,CAAC,CAAC,cAAc,CAAC,IAAI,CAAC,MAAM,CAAC,CAAA;;YAEpD,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC,QAAQ,CAAC,EAAE,EAAE,CAAC,CAAC,CAAA;YAE1D,IAAI,IAAI,CAAC,OAAO,KAAK,CAAC,EAAE;;gBAEpB,IAAM,WAAW,GAAG,CAAC,CAAC,SAAS,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,eAAe,CAAC,CAAA;gBACtE,IAAI,CAAC,sBAAsB,GAAG,CAAC,CAAC,SAAS,CAAC,WAAW,CAAC,CAAA;aACzD;iBAAM,IAAI,IAAI,CAAC,OAAO,GAAG,CAAC,EAAE;;gBAEzB,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC,QAAQ,CAAC,EAAE,EAAE,CAAC,CAAC,CAAA;;gBAEpC,IAAI,CAAC,OAAO,GAAG,CAAC,CAAC,SAAS,CAAC,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,UAAU,CAAC,CAAA;;gBAE7D,IAAI,CAAC,gBAAgB,GAAG,CAAC,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA;aACpD;YAED,IAAI,CAAC,SAAS,CAAC,YAAY,EAAE;gBACzB,MAAM,EAAE,EAAE;aACb,CAAC,CAAA;SACL;QACM,sBAAK,GAAZ,UAAa,EAAwB;YACjC,IAAI,CAAC,IAAI,CAAC,QAAQ;gBAAE,OAAM;YAC1B,IAAM,QAAQ,GAAG,CAAC,CAAC,QAAQ,CAAC,EAAE,EAAE,CAAC,CAAC,CAAA;YAIlC,IAAI,CAAC,IAAI,CAAC,UAAU;gBAAE,IAAI,CAAC,UAAU,GAAG,QAAQ,CAAA;YAChD,IAAI,IAAI,CAAC,OAAO,GAAG,CAAC,EAAE;;gBAElB,IAAM,WAAW,GAAG,CAAC,CAAC,QAAQ,CAAC,EAAE,EAAE,CAAC,CAAC,CAAA;gBACrC,IAAM,OAAO,GAAG,CAAC,CAAC,SAAS,CAAC,WAAW,EAAE,QAAQ,CAAC,CAAA;gBAClD,IAAM,WAAW,GAAG,CAAC,CAAC,SAAS,CAAC,OAAO,CAAC,CAAA;gBAExC,IAAI,IAAI,CAAC,gBAAgB,EAAE;oBACvB,IAAI,CAAC,UAAU,CAAC,OAAO,EAAE;wBACrB,MAAM,EAAE,EAAE;wBACV,KAAK,EAAE;4BACH,KAAK,EAAE,WAAW,GAAG,IAAI,CAAC,gBAAgB;yBAC7C;qBACJ,CAAC,CAAA;oBACF,IAAI,CAAC,gBAAgB,GAAG,WAAW,CAAA;iBACtC;gBAED,IAAI,IAAI,CAAC,OAAO,EAAE;oBACd,IAAI,CAAC,UAAU,CAAC,QAAQ,EAAE;wBACtB,KAAK,EAAE;4BACH,MAAM,EAAE,CAAC,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO,EAAE,OAAO,CAAC;yBAC5C;wBACD,MAAM,EAAE,EAAE;qBACb,CAAC,CAAA;oBACF,IAAI,CAAC,OAAO,GAAG,OAAO,CAAA;iBACzB;aACJ,AA4BA;;YAGD,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE;gBACpB,KAAK,EAAE;oBACH,CAAC,EAAE,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC;oBACjC,CAAC,EAAE,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC;iBACpC;gBACD,MAAM,EAAE,EAAE;aACb,CAAC,CAAA;YAEF,IAAI,CAAC,SAAS,CAAC,WAAW,EAAE;gBACxB,MAAM,EAAE,EAAE;aACb,CAAC,CAAA;YAEF,IAAI,CAAC,UAAU,GAAG,QAAQ,CAAA;SAC7B;QACM,qBAAI,GAAX,UAAY,EAAwB;YAApC,iBAqDC;YApDG,IAAM,KAAK,GAAG,CAAC,OAAO,EAAE,MAAM,EAAE,QAAQ,EAAE,cAAc,EAAE,aAAa,CAAC,CAAA;YACxE,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAA;YACrB,IAAI,CAAC,OAAO,GAAG,CAAC,CAAC,UAAU,CAAC,EAAE,CAAC,CAAA;YAE/B,KAAK,CAAC,GAAG,CAAC,UAAC,MAAc;gBACrB,KAAI,CAAC,QAAQ,CAAC,MAAM,EAAE;oBAClB,MAAM,EAAE,EAAE;oBACV,IAAI,EAAE,MAAM;iBACf,CAAC,CAAA;aACL,CAAC,CAAA;YAEF,IAAI,IAAI,CAAC,eAAe,EAAE;gBACtB,IAAM,QAAQ,GAAG;oBACb,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;oBAC/B,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;iBAClC,CAAA;gBACD,IAAM,MAAM,GAAG,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC,eAAe,CAAC,CAAC,CAAA;gBAClD,IAAM,MAAM,GAAG,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC,eAAe,CAAC,CAAC,CAAA;gBAClD,IAAM,OAAO,GAAG,IAAI,CAAC,GAAG,EAAE,CAAA;gBAC1B,IAAI,SAAS,GAAW,EAAE,CAAA;gBAC1B,IAAI,MAAM,GAAG,EAAE,IAAI,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,GAAG,EAAE;;oBAEvC,SAAS,GAAG,YAAY,CAAA;iBAC3B;qBAAM,IAAI,MAAM,GAAG,CAAC,EAAE,IAAI,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,GAAG,EAAE;;oBAE/C,SAAS,GAAG,WAAW,CAAA;iBAC1B;qBAAM,IAAI,MAAM,GAAG,EAAE,IAAI,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,GAAG,EAAE;;oBAE9C,SAAS,GAAG,WAAW,CAAA;iBAC1B;qBAAM,IAAI,MAAM,GAAG,CAAC,EAAE,IAAI,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,GAAG,EAAE;;oBAE/C,SAAS,GAAG,SAAS,CAAA;iBACxB;qBAAM,IAAI,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,EAAE,IAAI,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,EAAE,EAAG;oBACxD,IAAI,OAAO,GAAG,IAAI,CAAC,SAAS,GAAG,GAAG,EAAE;;wBAEhC,SAAS,GAAG,UAAU,CAAA;qBACzB;yBAAM;;wBAEH,SAAS,GAAG,SAAS,CAAA;qBACxB;iBACJ;gBAED,IAAI,SAAS,EAAE;oBACX,IAAI,CAAC,SAAS,CAAC,SAAS,EAAE;wBACtB,MAAM,EAAE,EAAE;qBACb,CAAC,CAAA;iBACL;aACJ;YAED,IAAI,CAAC,SAAS,CAAC,UAAU,EAAE;gBACvB,MAAM,EAAE,EAAE;aACb,CAAC,CAAA;SACL;QACO,0BAAS,GAAjB,UAAkB,MAAc,EAAE,EAGjC;YACG,IAAI,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE;gBAClB,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE;oBACpC,IAAI,EAAE,MAAM;oBACZ,eAAe;wBACX,EAAE,CAAC,MAAM,CAAC,eAAe,EAAE,CAAA;qBAC9B;iBACJ,CAAC,CAAC,CAAA;aACN;SACJ;QACM,wBAAO,GAAd;YAAA,iBAIC;YAHG,gBAAgB,CAAC,GAAG,CAAC,UAAC,EAAU;oBAAT,cAAI,EAAE,UAAE;gBAC3B,KAAI,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,EAAE,KAAI,CAAC,EAAE,CAAC,EAAE,KAAI,CAAC,CAAA;aACxC,CAAC,CAAA;SACL;QAEO,2BAAU,GAAlB,UAAmB,MAAc,EAAE,EAGlC;YACG,IAAM,GAAG,GAAM,MAAM,QAAK,CAAA;YAC1B,IAAM,KAAK,GAAM,MAAM,UAAO,CAAA;YAC9B,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE;gBACZ,IAAI,CAAC,SAAS,CAAC,KAAK,EAAE,EAAE,CAAC,CAAA;gBACzB,IAAI,CAAC,GAAG,CAAC,GAAG,IAAI,CAAA;aACnB;iBAAM;gBACH,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;aAC7B;SACJ;QAEO,yBAAQ,GAAhB,UAAiB,MAAc,EAAE,EAA0B;YACvD,IAAM,GAAG,GAAM,MAAM,QAAK,CAAA;YAC1B,IAAM,GAAG,GAAM,MAAM,QAAK,CAAA;YAC1B,IAAI,IAAI,CAAC,GAAG,CAAC,EAAE;gBACX,EAAE,CAAC,IAAI,GAAG,GAAG,CAAA;gBACb,IAAI,CAAC,SAAS,CAAC,GAAG,EAAE,EAAE,CAAC,CAAA;gBACvB,IAAI,CAAC,GAAG,CAAC,GAAG,KAAK,CAAA;aACpB;SACJ;QAEM,mBAAE,GAAT,UAAU,MAAc,EAAE,OAA2B;YAArD,iBAMC;YALG,IAAM,OAAO,GAAG,MAAM,CAAC,IAAI,EAAE,CAAC,WAAW,EAAE,CAAA;YAC3C,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,UAAC,IAAY;gBAChC,KAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,OAAO,CAAC,CAAA;aAC9B,CAAC,CAAA;YACF,OAAO,IAAI,CAAA;SACd;QAEM,oBAAG,GAAV,UAAW,MAAc,EAAE,OAA4B;YAAvD,iBAMC;YALG,IAAM,OAAO,GAAG,MAAM,CAAC,IAAI,EAAE,CAAC,WAAW,EAAE,CAAA;YAC3C,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,UAAC,IAAY;gBAChC,OAAO,GAAG,KAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,KAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,KAAK,EAAE,CAAA;aACjE,CAAC,CAAA;YACF,OAAO,IAAI,CAAA;SACd;QACL,aAAC;IAAD,CAAC,IAAA;;IClTD,SAAS,IAAI,CAAC,MAAW,EAAE,MAAc,EAAE,EAAY;QACnD,IAAI,oBAAoB,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE;YACvC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC;gBAAE,MAAM,CAAC,QAAQ,CAAC,GAAG,IAAI,MAAM,CAAC,MAAM,CAAC,CAAA;YAC5D,MAAM,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;SAClC;aAAM;YACH,MAAM,CAAC,WAAW,GAAG,IAAI,CAAA;YACzB,MAAM,CAAC,EAAE,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;SACxB;IACL,CAAC;IAED,SAAS,GAAG,CAAC,MAAW,EAAE,MAAc,EAAE,EAAa;QACnD,IAAI,oBAAoB,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,MAAM,CAAC,QAAQ,CAAC,EAAE;YAC3D,MAAM,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;SACnC;aAAM;YACH,MAAM,CAAC,WAAW,GAAG,IAAI,CAAA;YACzB,MAAM,CAAC,GAAG,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;SACzB;IACL,CAAC;AAED,QAAa,KAAK,GAAG;QACjB,EAAE,EAAF,UAAG,IAAiB,EAAE,OAA+B;YAAlD,qBAAA,EAAA,SAAiB;YAAE,wBAAA,EAAA,yBAA+B;YACjD,IAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAA;YAC9B,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;gBAClC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;oBACpC,IAAI,CAAC,CAAC,CAAC,CAAC,WAAW,GAAG,IAAI,CAAA;oBAC1B,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,CAAA;iBACpC;aACJ;YACD,OAAO,IAAI,CAAA;SACd;QACD,GAAG,EAAH,UAAI,IAAiB;YAAjB,qBAAA,EAAA,SAAiB;YACjB,IAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAA;YAC9B,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;gBAClC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;oBACpC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAA;oBACtB,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,CAAA;iBAC1B;aACJ;YACD,OAAO,IAAI,CAAA;SACd;KACJ,CAAA;AAED,IAEA;IACA,IAAI,MAAM,CAAC,KAAK;QAAE,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,CAAA;;;;;;;;;;;;;"}